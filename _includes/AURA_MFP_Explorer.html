<section class="AURA-MFP Architecture Explorer"></section>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
    integrity="sha384-...correct_hash..." crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
    integrity="sha384-...correct_hash..." crossorigin="anonymous"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .tab-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e0e0e0;
            justify-content: center;
            align-items: center;
            overflow-x: auto;
        }

        .tab {
            padding: 20px 30px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1em;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .tab:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .tab.active {
            color: #667eea;
            background: white;
            border-bottom: 3px solid #667eea;
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .module-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .module-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: var(--accent-color, #667eea);
        }

        .module-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            border-color: var(--accent-color, #667eea);
        }

        .module-card.core { --accent-color: #01579b; }
        .module-card.solver { --accent-color: #e65100; }
        .module-card.material { --accent-color: #4a148c; }
        .module-card.environment { --accent-color: #1b5e20; }
        .module-card.ml { --accent-color: #880e4f; }
        .module-card.optimization { --accent-color: #f57f17; }
        .module-card.command { --accent-color: #b71c1c; }
        .module-card.utility { --accent-color: #37474f; }
        .module-card.python { --accent-color: #004d40; }

        .module-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .module-info {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
            margin-right: 5px;
            margin-top: 5px;
        }

        .badge.complete { background: #c8e6c9; color: #2e7d32; }
        .badge.progress { background: #fff9c4; color: #f57f17; }
        .badge.experimental { background: #ffccbc; color: #d84315; }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
        }

        #dependency-graph {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            overflow-x: auto;
        }

        .layer-section {
            margin-bottom: 30px;
        }

        .layer-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 1.3em;
            font-weight: bold;
        }

        .timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 30px;
            padding-left: 30px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -36px;
            top: 5px;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: white;
            border: 3px solid #667eea;
        }

        .timeline-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .timeline-content {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
        }

        .search-box {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .search-box:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .filter-btn {
            padding: 10px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 20px;
            background: white;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.3s;
        }

        .filter-btn:hover {
            background: #f8f9fa;
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }

        .modal.active {
            display: flex !important;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #f8f9fa;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .close-modal:hover {
            background: #667eea;
            color: white;
        }

        .dependency-list {
            list-style: none;
            padding-left: 0;
        }

        .dependency-list li {
            padding: 8px;
            border-left: 3px solid #667eea;
            margin-bottom: 5px;
            padding-left: 15px;
            background: #f8f9fa;
            border-radius: 0 5px 5px 0;
        }

        code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            h1 { font-size: 1.8em; }
            .module-grid { grid-template-columns: 1fr; }
            .tabs { flex-direction: column; }
            .tab { text-align: left; }
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .layer-box {
            border: 2px solid;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            text-align: center;
            font-weight: 600;
            transition: all 0.3s;
            cursor: pointer;
        }

        .layer-box:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .arrow-down {
            text-align: center;
            font-size: 2em;
            color: #667eea;
            margin: 10px 0;
        }
    </style>
<body>
    <div class="container">
        <header>
            <h1>üåü AURA-MFP Architecture Explorer</h1>
            <div class="subtitle">Atmosphere-Unified Radiation Assessment with Multi-Fidelity for Photovoltaics</div>
            <div class="subtitle">Beta v2.0 | February 2026 | Confidential Working Document</div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">101</div>
                    <div class="stat-label">Total Source Files</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">73</div>
                    <div class="stat-label">Fortran Modules</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">18</div>
                    <div class="stat-label">Python Modules</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">55.6K</div>
                    <div class="stat-label">Lines of Code</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">87%</div>
                    <div class="stat-label">Overall Progress</div>
                </div>
            </div>
        </header>

        <div class="tab-container">
            <div class="tabs">
                <button class="tab" data-tab="arch">üèóÔ∏è Architecture</button>
                <button class="tab" data-tab="modules">üì¶ Modules</button>
                <button class="tab" data-tab="dependencies">üîó Dependencies</button>
                <button class="tab" data-tab="roadmap">üó∫Ô∏è Roadmap</button>
                <button class="tab" data-tab="simulations">üöÄ Simulations</button>
            </div>

            <div id="arch" class="tab-content">
                <h2>Layered Architecture</h2>
                <div class="layer-section">
                    <div class="layer-box" style="border-color: #004d40; background: rgba(0, 77, 64, 0.05);">
                        Layer 4 (Top): Rust GUI (bin/aura_mfp ¬∑ egui/eframe) ‚Äî egui native desktop, live CSV plots, terminal, run_config.json reader
                    </div>
                    <div class="arrow-down">‚Üì</div>
                    <div class="layer-box" style="border-color: #37474f; background: rgba(55, 71, 79, 0.05);">
                        Layer 4 (Bridge): C Interpreter (aura_interp.c / .h) ‚Äî fork/exec process spawning, ring-buffer stdout capture, JSON config serialisation
                    </div>
                    <div class="arrow-down">‚Üì</div>
                    <div class="layer-box" style="border-color: #b71c1c; background: rgba(183, 28, 28, 0.05);">
                        Layer 3: Python Orchestration (run_sim.py + simv1‚Äì4_wrapper.py) ‚Äî Perez POA, Fresnel IAM, Faiman thermal, GP/PSO/RL surrogate management
                    </div>
                    <div class="arrow-down">‚Üì</div>
                    <div class="layer-box" style="border-color: #01579b; background: rgba(1, 87, 155, 0.05);">
                        Layer 1 (Bottom): Fortran 2018 Physics Kernel (bin/aura_mf) ‚Äî BTE MC, Crank-Nicolson 3D heat, Navier-Stokes, PSO, co-Kriging BO, Q-learning RL, adjoint
                    </div>
                </div>
            </div>

            <div id="modules" class="tab-content">
                <h2 style="margin-bottom: 20px;">Module Explorer</h2>
                
                <input type="text" id="module-search" class="search-box" placeholder="üîç Search modules by name, function, or description...">
                
                <div class="filter-buttons">
                    <button class="filter-btn active" data-filter="all">All Modules</button>
                    <button class="filter-btn" data-filter="core">Core</button>
                    <button class="filter-btn" data-filter="solver">Solvers</button>
                    <button class="filter-btn" data-filter="material">Materials</button>
                    <button class="filter-btn" data-filter="environment">Environment</button>
                    <button class="filter-btn" data-filter="ml">ML</button>
                    <button class="filter-btn" data-filter="optimization">Optimization</button>
                    <button class="filter-btn" data-filter="command">Commands</button>
                    <button class="filter-btn" data-filter="utility">Utilities</button>
                    <button class="filter-btn" data-filter="python">Python</button>
                </div>

                <div id="module-list" class="module-grid"></div>
            </div>

            <div id="dependencies" class="tab-content">
                <h2 style="margin-bottom: 20px;">Dependency Analysis</h2>
                
                <div class="layer-section">
                    <div class="layer-header">üîù Most Depended-On Modules</div>
                    <div style="background: white; padding: 20px; border-radius: 10px;">
                        <ol style="padding-left: 20px; line-height: 2;">
                            <li><strong>precision_module</strong> - Used by <span class="highlight">all 73 Fortran modules</span> (must compile first)</li>
                            <li><strong>types_module</strong> - Used by <span class="highlight">~40 modules</span> (all solver and command layers)</li>
                            <li><strong>constants_module</strong> - Used by <span class="highlight">~28 modules</span></li>
                            <li><strong>error_module</strong> - Used by <span class="highlight">~15 modules</span></li>
                            <li><strong>silicon_module</strong> - Used by <span class="highlight">~8 modules</span> (BTE MC, optical, material)</li>
                        </ol>
                    </div>
                </div>

                <div class="layer-section">
                    <div class="layer-header">üîÑ Longest Dependency Chains</div>
                    <div style="background: white; padding: 20px; border-radius: 10px;">
                        <p style="margin-bottom: 15px;"><strong>Chain 1 (deepest ‚Äî SimV4 RL path):</strong></p>
                        <code style="display: block; padding: 15px; background: #f8f9fa; border-radius: 5px; overflow-x: auto;">
                            main.f90 ‚Üí sim4_command ‚Üí ml_orchestrator ‚Üí rl_interface ‚Üí state_feature_module ‚Üí types_module ‚Üí precision_module
                        </code>
                        
                        <p style="margin: 20px 0 15px;"><strong>Chain 2 (SimV1 HiFi path):</strong></p>
                        <code style="display: block; padding: 15px; background: #f8f9fa; border-radius: 5px; overflow-x: auto;">
                            main.f90 ‚Üí sim1_command ‚Üí hifi_solver ‚Üí bte_monte_carlo ‚Üí silicon_module ‚Üí constants_module ‚Üí precision_module
                        </code>

                        <p style="margin: 20px 0 15px;"><strong>Chain 3 (Python ‚Üí Fortran ‚Üí Physics):</strong></p>
                        <code style="display: block; padding: 15px; background: #f8f9fa; border-radius: 5px; overflow-x: auto;">
                            simv3_wrapper.py ‚Üí run_sim.py ‚Üí [subprocess] ‚Üí sim3_command ‚Üí bayesian_module ‚Üí lofi_solver ‚Üí precision_module
                        </code>
                    </div>
                </div>

                <div class="layer-section">
                    <div class="layer-header">üìä Fortran Compilation Order (Dependency Levels)</div>
                    <div style="background: white; padding: 20px; border-radius: 10px;">
                        <div style="margin-bottom: 15px;">
                            <strong>Level 0 ‚Äî Foundation (compile first):</strong>
                            <p style="color: #666; margin-top: 5px;">precision_module</p>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <strong>Level 1:</strong>
                            <p style="color: #666; margin-top: 5px;">constants_module, error_module</p>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <strong>Level 2:</strong>
                            <p style="color: #666; margin-top: 5px;">types_module, timer_module, validation_module</p>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <strong>Level 3:</strong>
                            <p style="color: #666; margin-top: 5px;">data_module, tuning_module, linear_solvers, silicon_module, optical_module, thermal_module</p>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <strong>Level 4:</strong>
                            <p style="color: #666; margin-top: 5px;">material_module, optical_properties_module, solar_module, atmospheric_module, weather_module, bte_diffusion, bte_monte_carlo, boundary_conditions_module, adaptive_timestep_module, tensor_surrogate_module</p>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <strong>Level 5:</strong>
                            <p style="color: #666; margin-top: 5px;">environmental_module, climate_zone_module, weather_data_module, surface_radiation_module, air_layer_module, implicit_heat_solver_module, lofi_solver_module, adjoint_module, mcmc_sampler_module, acquisition_module, state_feature_module, reward_function_module, decision_tree_module</p>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <strong>Level 6:</strong>
                            <p style="color: #666; margin-top: 5px;">weather_driver_module, mefi_solver_module, solver_selection_module, unified_heat_solver_module, conjugate_ht, navier_stokes, pso_module, bayesian_module, adjoint_gradient_check_module, rl_interface_module, fidelity_manager_module, io_module, sim_utils_module, cleanup_utilities</p>
                        </div>
                        <div>
                            <strong>Level 7‚Äì8 ‚Äî Top layer (compile last):</strong>
                            <p style="color: #666; margin-top: 5px;">hifi_solver_module, simv2_pso_fitness_module, optimization_module, ml_orchestrator_module, timestep_adjustment ‚Üí then sim1/2/3/4_command_module ‚Üí main.f90</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="roadmap" class="tab-content">
                <h2 style="margin-bottom: 20px;">Development Roadmap</h2>
                
                <div class="timeline">
                    <div class="timeline-item">
                        <div class="timeline-title">‚úÖ Completed (verified in v2.0 codebase)</div>
                        <div class="timeline-content">
                            <ul style="list-style: none; padding: 0;">
                                <li>‚úì Core infrastructure: precision/constants/types/error/data/tuning modules (6 modules, 2,748 LOC)</li>
                                <li>‚úì All physics solvers: BTE MC + BTE diffusion + CN heat + Navier-Stokes + ADI + BC + lofi/mefi/hifi (13 modules, 7,179 LOC)</li>
                                <li>‚úì Full material stack: silicon + optical + thermal + material modules (5 modules, 2,573 LOC)</li>
                                <li>‚úì Complete environment layer: NREL SPA solar, Bird 1984 spectral, atmospheric, weather, AR(1)+Fourier climate driver (9 modules, 6,642 LOC)</li>
                                <li>‚úì All optimisation algorithms: PSO (Clerc), co-Kriging GP (Kennedy-O'Hagan), MCMC (Metropolis-Hastings), adjoint, EI/UCB/PI/PIAF acquisition (9 modules)</li>
                                <li>‚úì RL components: state features, reward function, decision tree fallback, ml_orchestrator (4 of 5 ML modules complete)</li>
                                <li>‚úì Rust egui GUI (bin/aura_mfp): live CSV plots, terminal, params tab, config persistence</li>
                                <li>‚úì C interpreter bridge (aura_interp.c): fork/exec, ring-buffer stdout, JSON config</li>
                                <li>‚úì SimV1 high-fidelity runner: BTE MC + CN heat + NS + adjoint sensitivity</li>
                                <li>‚úì SimV2 multi-fidelity + PSO: LF/MF/HF alternating + Clerc constriction + tensor surrogate</li>
                                <li>‚úì SimV3 Bayesian BO: co-Kriging GP + EI/UCB/PI/PIAF + --fidelity flag (Gap 2 resolved)</li>
                                <li>‚úì Python physics engine (pv_physics_engine.py): Perez POA, Fresnel IAM, Faiman thermal, SAPM, M_spectral</li>
                                <li>‚úì Python wrappers for SimV1/2/3/4, weather bridge, bayesian analysis, build manager</li>
                                <li>‚úì data_acquisition.py wired to build_manager.py prepare-data target (Gap 5 resolved)</li>
                                <li>‚úì Makefile + CMakeLists.txt build system (494 LOC, correct dependency order)</li>
                                <li>‚úì 3 test files written (839 combined LOC) ‚Äî test_pv_physics_engine, test_simv2_wrapper, test_tuning_module_consistency</li>
                            </ul>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-title">‚ö†Ô∏è In Progress ‚Äî Open Gaps</div>
                        <div class="timeline-content">
                            <ul style="list-style: none; padding: 0;">
                                <li>‚öôÔ∏è <strong>Gap 1 (Critical ~16h):</strong> Test suite not wired ‚Äî conftest.py, pytest.ini missing; test_weather_bridge.py in wrong directory; build_manager.py --test does not invoke pytest</li>
                                <li>‚öôÔ∏è <strong>Gap 3 (~3h):</strong> M_spectral not propagated to Fortran ‚Äî hifi_solver_module hardcodes 1.0; ~5% photon energy error under non-STC atmosphere</li>
                                <li>‚öôÔ∏è <strong>Gap 4 (~3h):</strong> Adjoint gradient check bypassed ‚Äî adjoint_gradient_check_module.f90 is complete but call site in sim1_command_module.f90 is commented out (missing forward_eval function pointer)</li>
                                <li>‚öôÔ∏è <strong>Gap 6 (~16‚Äì32h, design decision):</strong> SimV4 dual RL architecture ‚Äî Python Q-table (SAPM, 128 states, 0.1ms/eval) and Fortran Q-table (HiFi, ~50s/eval) are completely separate and never communicate</li>
                                <li>‚öôÔ∏è <strong>T0-A (Blocker):</strong> data/ directory entirely missing ‚Äî data/si_nk_table.dat absence causes hard exit at startup; all 7 required data files need to be generated</li>
                            </ul>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-title">üìÖ Planned (2026)</div>
                        <div class="timeline-content">
                            <ul style="list-style: none; padding: 0;">
                                <li>üéØ CI/CD pipeline (GitHub Actions): make test + pytest + cargo test on push</li>
                                <li>üéØ fidelity_manager_module ‚Üî simv3_wrapper.get_scaling_factor() sync audit + regression test</li>
                                <li>üéØ SimV4 RL unification (Option A recommended: Python orchestrates, Fortran executes single-step oracle calls)</li>
                                <li>üéØ Extend Sandia PVMC validation dataset for SimV1 regression suite</li>
                                <li>üéØ Multi-GPU support (CUDA/OpenACC for BTE MC photon batches)</li>
                                <li>üéØ MPI parallelisation for large grid runs</li>
                                <li>üéØ NetCDF I/O for long time-series datasets</li>
                                <li>üéØ Experimental validation against physical PV hardware</li>
                            </ul>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-title">üî¨ Research Phase (2027+)</div>
                        <div class="timeline-content">
                            <ul style="list-style: none; padding: 0;">
                                <li>üî¨ Physics-informed neural network surrogates replacing co-Kriging GP</li>
                                <li>üî¨ Transfer learning across PV geometries and materials</li>
                                <li>üî¨ Full Pareto-front multi-objective optimisation (power + degradation + cost)</li>
                                <li>üî¨ Integration with climate models (WRF, CESM) for long-horizon yield simulation</li>
                                <li>üî¨ Uncertainty quantification framework for publication-grade results</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="layer-section" style="margin-top: 40px;">
                    <div class="layer-header">üéØ Development Priorities (by blocker impact)</div>
                    <div style="background: white; padding: 20px; border-radius: 10px;">
                        <ol style="padding-left: 20px; line-height: 2.5;">
                            <li><strong>Generate missing data/ files (T0-A)</strong> ‚Äî Hard blocker: optical_module.f90 hard-exits without data/si_nk_table.dat at startup</li>
                            <li><strong>Wire pytest test suite (Gap 1, ~16h)</strong> ‚Äî Zero automated coverage currently; create conftest.py + pytest.ini; move test_weather_bridge.py</li>
                            <li><strong>Propagate M_spectral to Fortran (Gap 3, ~3h)</strong> ‚Äî ~5% photon energy error under non-STC conditions; add --spectral-mismatch CLI flag to main.f90</li>
                            <li><strong>Re-activate adjoint gradient check (Gap 4, ~3h)</strong> ‚Äî Module complete; add simv1_forward_eval() wrapper and procedure pointer in sim1_command_module</li>
                            <li><strong>Unify SimV4 RL architecture (Gap 6, ~16‚Äì32h)</strong> ‚Äî Design decision required; recommended: Python orchestrates, Fortran executes single-step oracle actions</li>
                        </ol>
                    </div>
                </div>
            </div>

            <div id="simulations" class="tab-content">
                <h2 style="margin-bottom: 20px;">Simulation Modes</h2>
                
                <div class="module-grid">
                    <div class="module-card command">
                        <div class="module-title">SimV1: Full High-Fidelity</div>
                        <div class="module-info">3D BTE Monte Carlo + Crank-Nicolson heat + Navier-Stokes + adjoint sensitivity</div>
                        <div class="module-info">Status: <span class="badge progress">90% Complete</span></div>
                        <div class="module-info">Runtime: 15‚Äì45 minutes (grid-dependent)</div>
                        <div class="module-info">Use case: Highest accuracy; adjoint-guided parameter studies</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 90%;"></div>
                        </div>
                        <div style="margin-top: 15px;">
                            <strong>Implemented:</strong>
                            <ul style="margin-top: 10px; padding-left: 20px; font-size: 0.9em;">
                                <li>BTE MC (AM1.5G CDF sampling, Beer-Lambert Œ±=1e5 m‚Åª¬π, Fresnel at all interfaces)</li>
                                <li>Crank-Nicolson Œ∏=0.5 3D heat (ADI splitting, unconditionally stable)</li>
                                <li>Navier-Stokes with Boussinesq buoyancy, CFL sub-stepping</li>
                                <li>Lagrange multiplier adjoint: dJ/d[k_thermal, alpha, h_conv]</li>
                                <li>Perez POA + Fresnel IAM + Faiman thermal (Python Stage 1)</li>
                            </ul>
                            <strong style="color: #e65100;">Open: Gap 3</strong> ‚Äî M_spectral hardcoded 1.0 (~5% photon energy error); <strong>Gap 4</strong> ‚Äî adjoint gradient check bypassed at call site
                        </div>
                    </div>

                    <div class="module-card command">
                        <div class="module-title">SimV2: Multi-Fidelity + PSO</div>
                        <div class="module-info">Alternates LF Beer-Lambert and HiFi BTE MC; Particle Swarm Optimization with CP-ALS surrogate</div>
                        <div class="module-info">Status: <span class="badge complete">95% Complete</span></div>
                        <div class="module-info">Runtime: ~5‚Äì10√ó faster than SimV1 for equivalent design search</div>
                        <div class="module-info">Use case: Panel design optimisation; parameter screening</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 95%;"></div>
                        </div>
                        <div style="margin-top: 15px;">
                            <strong>Implemented:</strong>
                            <ul style="margin-top: 10px; padding-left: 20px; font-size: 0.9em;">
                                <li>Clerc constriction PSO (w=0.729, c1=c2=1.49445, theoretically stable)</li>
                                <li>LF/MF/HF alternating fidelity with T_corrected blending</li>
                                <li>CP-ALS tensor surrogate for fitness landscape approximation</li>
                                <li>PSO fitness: J = w_T¬∑RMSE + w_cost¬∑t_cpu + w_unif¬∑uniformity</li>
                                <li>Latin Hypercube Sampling for initial Python-side sampling</li>
                            </ul>
                        </div>
                    </div>

                    <div class="module-card command">
                        <div class="module-title">SimV3: Bayesian Optimisation</div>
                        <div class="module-info">Kennedy-O'Hagan co-Kriging GP surrogate + EI/UCB/PI/PIAF acquisition; --fidelity override resolved</div>
                        <div class="module-info">Status: <span class="badge complete">90% Complete</span></div>
                        <div class="module-info">Runtime: Optimal accuracy/cost; GP_MAX_TRAIN capped at 200 points</div>
                        <div class="module-info">Use case: Global optimum search with uncertainty quantification</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 90%;"></div>
                        </div>
                        <div style="margin-top: 15px;">
                            <strong>Implemented:</strong>
                            <ul style="margin-top: 10px; padding-left: 20px; font-size: 0.9em;">
                                <li>Kennedy-O'Hagan co-Kriging: f_HF(x) = œÅ¬∑f_LF(x) + Œ¥(x), Cholesky solve</li>
                                <li>Acquisition: EI (Mockus 1974), UCB (Œ∫=2), PI, PIAF (penalises T_cell > 85¬∞C)</li>
                                <li>MCMC (Adaptive M-H): R-hat + ESS diagnostics, posterior UQ</li>
                                <li>--fidelity 0/1/2 CLI flag (Gap 2 resolved)</li>
                                <li>Writes simv3_gp_diagnostics.csv and simv3_summary.csv</li>
                            </ul>
                        </div>
                    </div>

                    <div class="module-card command">
                        <div class="module-title">SimV4: RL-Orchestrated</div>
                        <div class="module-info">Q-learning agent allocates compute budget across LF/HF evaluations ‚Äî DUAL ARCHITECTURE UNRESOLVED</div>
                        <div class="module-info">Status: <span class="badge experimental">60% Complete</span></div>
                        <div class="module-info">Runtime: Adaptive (learns optimal budget allocation policy)</div>
                        <div class="module-info">Use case: Research / autonomous multi-fidelity exploration</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 60%;"></div>
                        </div>
                        <div style="margin-top: 15px;">
                            <strong>Implemented (partial):</strong>
                            <ul style="margin-top: 10px; padding-left: 20px; font-size: 0.9em;">
                                <li>State features: T gradient, rate-of-change, remaining budget, Sobol indices</li>
                                <li>Reward: r = improvement(Pmp) - cost(action) + physics penalty (Ng 1999 shaping)</li>
                                <li>Decision tree fallback policy (sigma_frac/R2/n_HF heuristics)</li>
                                <li>Python: Œµ-greedy Q-table over SAPM surrogate (128 states, ~0.1ms/eval)</li>
                                <li>Fortran: separate Q-table over HiFi solver (~50s/eval, different state space)</li>
                            </ul>
                            <strong style="color: #e65100;">Open: Gap 6</strong> ‚Äî Two independent Q-tables that never communicate. Must unify (recommended: Python orchestrates, Fortran as single-step oracle).
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="module-modal" class="modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <div id="modal-body"></div>
        </div>
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                curve: 'basis',
                padding: 20
            }
        });

        // Module data ‚Äî verified against Archive.zip source + Developer Handbook + Analysis Report (Feb 2026)
        const modules = {
            core: [
                { name: 'precision_module', file: 'precision_module.f90', lines: 79, complete: 100, functions: ['WP = REAL64 kind parameter', 'I4 = INT32 kind parameter', 'EPSILON_WP tolerance constant'], deps: [], description: 'Defines WP (REAL64) and I4 (INT32) kind parameters used by all 73 modules. Must compile first.' },
                { name: 'constants_module', file: 'constants_module.f90', lines: 307, complete: 100, functions: ['PI, k_B, sigma_SB, c_light', 'e_charge, h_Planck', 'PV-specific STC constants', 'AM1.5G reference values'], deps: ['precision_module'], description: 'CODATA 2018 physical constants plus PV-specific values. Single source of truth for all physical constants.' },
                { name: 'error_module', file: 'error_module.f90', lines: 285, complete: 100, functions: ['set_error(code, message, location)', 'clear_error()', 'print_error()', 'IS_ERROR() macro', 'ERR_SUCCESS = 0'], deps: ['precision_module'], description: 'Structured error propagation. error_type holds code, message, and call-site location. Used by all modules.' },
                { name: 'types_module', file: 'types_module.f90', lines: 564, complete: 100, functions: ['grid_type', 'material_type', 'boundary_condition_type', 'simulation_config_type', 'simv1/2/3/4 config types', 'simv1/2/3/4 result types'], deps: ['precision_module', 'constants_module'], description: 'All Fortran derived types for the simulation framework. Central schema for data passing between layers.' },
                { name: 'data_module', file: 'data_module.f90', lines: 373, complete: 100, functions: ['Global grid and field arrays: T, u, v, w, q_abs', 'dt_current timestep', 'n_calls_LF / n_calls_MF / n_calls_HF counters', 'n_timesteps_completed'], deps: ['types_module', 'precision_module'], description: 'Global simulation state: grid, field arrays, and performance counters shared across all solvers.' },
                { name: 'tuning_module', file: 'tuning_module.f90', lines: 1140, complete: 100, functions: ['tuning_config_type (aggregates env/solver/simv1-4 sub-configs)', 'load_default_tuning()', 'validate_tuning()', 'apply_tuning_simv1/2/3/4()', 'print_tuning_report()'], deps: ['types_module', 'precision_module'], description: 'Central parameter repository ‚Äî the single source of truth for all tunable constants across the entire framework.' }
            ],
            solver: [
                { name: 'linear_solvers', file: 'linear_solvers.f90', lines: 389, complete: 100, functions: ['TDMA tridiagonal solver', 'SOR iterative solver', 'Convergence monitoring'], deps: ['precision_module'], description: 'TDMA and SOR solvers used by all heat equation modules.' },
                { name: 'bte_diffusion', file: 'bte_diffusion.f90', lines: 137, complete: 100, functions: ['bte_diffusion_solve()', 'Photon diffusion for albedo > 0.8'], deps: ['precision_module', 'types_module'], description: 'Photon diffusion approximation of BTE. Activated in MedFi mode for high-scattering silicon.' },
                { name: 'bte_monte_carlo', file: 'bte_monte_carlo.f90', lines: 731, complete: 95, functions: ['run_photon_batch()', 'AM1.5G CDF wavelength sampling', 'Beer-Lambert attenuation (alpha=1e5 m‚Åª¬π for Si visible)', 'Fresnel reflectance at each interface', 'q_absorbed[nx,ny,nz] energy deposition'], deps: ['types_module', 'precision_module', 'constants_module', 'silicon_module'], description: '95% ‚Äî Monte Carlo Boltzmann Transport. NOTE: hf_state%M_spectral hardcoded 1.0 (Gap 3 ‚Äî ~5% photon energy error under non-STC atmosphere).' },
                { name: 'boundary_conditions_module', file: 'boundary_conditions_module.f90', lines: 550, complete: 100, functions: ['apply_thermal_bc()', 'Dirichlet (fixed T)', 'Neumann (zero flux)', 'Robin: h¬∑dz/k ghost cell (dz=60¬µm)', 'Convective+radiative linearised Stefan-Boltzmann'], deps: ['types_module', 'precision_module'], description: 'All thermal boundary conditions. Ghost cell spacing dz=60¬µm correctly set.' },
                { name: 'implicit_heat_solver_module', file: 'implicit_heat_solver_module.f90', lines: 373, complete: 100, functions: ['solve_heat_implicit_cn()', 'Crank-Nicolson theta=0.5', 'ADI x/y/z sweep splitting', 'TDMA tridiagonal calls', 'Robin BCs on all faces'], deps: ['precision_module', 'types_module', 'linear_solvers'], description: 'Crank-Nicolson 3D heat equation. Unconditionally stable for all dt.' },
                { name: 'conjugate_ht', file: 'conjugate_ht.f90', lines: 71, complete: 100, functions: ['conjugate_heat_transfer() thin wrapper'], deps: ['precision_module', 'types_module'], description: 'Conjugate heat transfer at fluid-solid interface. Used by navier_stokes.f90 for panel surface consistency.' },
                { name: 'unified_heat_solver_module', file: 'unified_heat_solver_module.f90', lines: 360, complete: 100, functions: ['solve_heat_unified()', 'CFL-based dispatch: CN implicit vs adaptive explicit'], deps: ['implicit_heat_solver_module', 'solver_selection_module'], description: 'Dispatcher: checks CFL and routes to CN implicit or adaptive explicit solver.' },
                { name: 'solver_selection_module', file: 'solver_selection_module.f90', lines: 300, complete: 100, functions: ['select_solver()', 'CFL analysis: CFL<=0.4 -> explicit OK, CFL>0.4 -> force CN implicit', 'omega_sor recommendation', 'dt adjustment guidance'], deps: ['precision_module', 'types_module'], description: 'Auto-selects solver based on CFL analysis and recommends timestep adjustments.' },
                { name: 'adaptive_timestep_module', file: 'adaptive_timestep_module.f90', lines: 307, complete: 100, functions: ['adapt_dt()', 'Increase dt when CFL << threshold', 'Decrease when approaching instability boundary'], deps: ['precision_module'], description: 'Dynamic dt adjustment coordinated with solver_selection_module.' },
                { name: 'lofi_solver_module', file: 'lofi_solver_module.f90', lines: 554, complete: 100, functions: ['solve_lofi_timestep()', 'Beer-Lambert single-pass volumetric heat deposition', '1D heat diffusion', '~100x faster than HiFi'], deps: ['types_module', 'precision_module'], description: 'Low-fidelity fast solver for initial BO sampling and RL cheap evaluations.' },
                { name: 'mefi_solver_module', file: 'mefi_solver_module.f90', lines: 844, complete: 100, functions: ['solve_mefi_timestep()', 'BTE diffusion (not full MC)', 'Implicit CN heat', 'T_corrected = (1-0.75)*T_lofi + 0.75*T_hifi blending in SimV2'], deps: ['types_module', 'bte_diffusion', 'implicit_heat_solver_module'], description: 'Medium-fidelity solver: BTE diffusion + implicit CN heat. Intermediate accuracy/cost.' },
                { name: 'hifi_solver_module', file: 'hifi_solver_module.f90', lines: 1397, complete: 90, functions: ['solve_hifi_timestep()', 'BTE MC photon batch', 'CN 3D heat solve', 'Robin BC update', 'NS velocity update', 'write live_data.csv with FLUSH every progress_interval steps'], deps: ['bte_monte_carlo', 'navier_stokes', 'implicit_heat_solver_module', 'boundary_conditions_module'], description: '90% ‚Äî High-fidelity solver. NOTE: hf_state%M_spectral stuck at 1.0 until Gap 3 resolved.' },
                { name: 'navier_stokes', file: 'navier_stokes.f90', lines: 2073, complete: 100, functions: ['update_velocities_hifi()', 'CFL<=0.4 sub-stepping enforcement', 'Boussinesq buoyancy: beta*(T-T_ref)*g', 'Incompressible continuity enforcement'], deps: ['types_module', 'precision_module', 'constants_module'], description: 'Incompressible NS with buoyancy. For 300¬µm Si panels Ra<<1000 so forced convection dominates.' }
            ],
            material: [
                { name: 'optical_module', file: 'optical_module.f90', lines: 756, complete: 90, functions: ['initialize_optical_module(path)', 'compute_absorption_coefficient(): alpha=4*pi*k/lambda', 'compute_fresnel_reflectance(): R=((n1-n2)^2+k2^2)/((n1+n2)^2+k2^2)', '50-bin wavelength lookup table (0.3‚Äì1.2 ¬µm)'], deps: ['precision_module', 'constants_module'], description: '90% ‚Äî Reads si_nk_table.dat into n/k lookup table. BLOCKER: requires data/si_nk_table.dat (currently MISSING ‚Äî must be generated).' },
                { name: 'optical_properties_module', file: 'optical_properties_module.f90', lines: 388, complete: 100, functions: ['Wavelength-indexed n(lambda), k(lambda), alpha(lambda)', 'Interpolation for arbitrary BTE wavelengths', 'n_wavelengths for BTE sampler'], deps: ['precision_module', 'optical_module'], description: 'Higher-level optical property manager with interpolation interface for the BTE MC sampler.' },
                { name: 'silicon_module', file: 'silicon_module.f90', lines: 441, complete: 100, functions: ['initialize_silicon(T_init=300K, n_wavelengths=100)', 'Varshni bandgap: E_g(T)=E_g0-a*T^2/(T+b)', 'Glassbrenner-Slack k_thermal(T)', 'Glassbrenner rho*cp(T)'], deps: ['precision_module', 'constants_module'], description: 'Temperature-dependent silicon properties. Franta 300K crystalline silicon n/k source data.' },
                { name: 'thermal_module', file: 'thermal_module.f90', lines: 499, complete: 100, functions: ['k_thermal(T) for Si/glass/EVA', 'cp(T) specific heat capacity per layer', 'rho(T) density per layer'], deps: ['precision_module', 'constants_module'], description: 'Temperature-dependent thermal properties for all PV stack layers (Si, glass, EVA).' },
                { name: 'material_module', file: 'material_module.f90', lines: 489, complete: 100, functions: ['PV stack: Si (300¬µm), EVA (450¬µm), glass (3.2mm)', 'Layer-aware property lookups', 'BC integration for heat solver interfaces'], deps: ['silicon_module', 'optical_module', 'thermal_module'], description: 'Unified multi-layer PV stack material interface. Provides layer-aware property lookups.' }
            ],
            environment: [
                { name: 'solar_module', file: 'solar_module.f90', lines: 1219, complete: 100, functions: ['compute_solar_position(): NREL SPA (Reda & Andreas 2004, ¬±0.0003 deg)', 'compute_solar_irradiance(): Bird 1984 spectral model', 'Rayleigh/aerosol/ozone/water corrections', 'compute_dni_dhi(): direct/diffuse decomposition'], deps: ['precision_module', 'constants_module'], description: 'NREL SPA solar geometry + Bird 1984 spectral irradiance model. Research-grade accuracy.' },
                { name: 'atmospheric_module', file: 'atmospheric_module.f90', lines: 1008, complete: 100, functions: ['Atmospheric transmittance', 'Rayleigh/Mie scattering coefficients', 'Precipitable water', 'Angstrom turbidity exponent'], deps: ['precision_module', 'constants_module'], description: 'Atmospheric transmittance and scattering. Used by solar_module for spectral irradiance corrections.' },
                { name: 'weather_module', file: 'weather_module.f90', lines: 1133, complete: 100, functions: ['weather_state_type: T_air, RH, P_atm, wind_speed, cloud_fraction', 'CSV time-series reader', 'query_weather_at(t): linear interpolation between records'], deps: ['precision_module'], description: 'Weather state data types, CSV reader, and interpolation interface.' },
                { name: 'environmental_module', file: 'environmental_module.f90', lines: 907, complete: 100, functions: ['update_environment(t, lat, lon)', 'Combines solar + weather + atmospheric', 'Outputs: G_beam, G_diffuse, T_sky, h_conv'], deps: ['solar_module', 'atmospheric_module', 'weather_module'], description: 'Top-level environment coordinator. Provides G_beam, G_diffuse, T_sky, h_conv per timestep.' },
                { name: 'climate_zone_module', file: 'climate_zone_module.f90', lines: 576, complete: 100, functions: ['8-zone classification by latitude band', 'Zone types: Tropical/Subtropical/Arid/Maritime/Continental/Subarctic/Arctic', 'AR(1) daily coefficient phi_day per zone', 'Seasonal amplitude, mean T, mean G_beam'], deps: ['precision_module'], description: 'Climate zone classification. AR(1)+Fourier coefficients burned in from offline R/ML analysis.' },
                { name: 'weather_driver_module', file: 'weather_driver_module.f90', lines: 556, complete: 100, functions: ['generate_weather_timeseries()', 'Phase 1: Fourier seasonal baseline', 'Phase 2: AR(1) daily anomaly (phi_day from climate_zone_module)', 'Phase 3: Hourly disaggregation'], deps: ['climate_zone_module', 'precision_module'], description: 'Phase 2 weather engine. Activated when t_final > 3600s. Generates synthetic hourly weather.' },
                { name: 'weather_data_module', file: 'weather_data_module.f90', lines: 377, complete: 100, functions: ['weather_data_series: array of hourly records', 'weather_driver_active flag', 'fill_G_beam_series()', 'query_weather_at(): linear interpolation'], deps: ['weather_module', 'weather_driver_module'], description: 'Runtime weather data storage and per-step query interface.' },
                { name: 'surface_radiation_module', file: 'surface_radiation_module.f90', lines: 695, complete: 100, functions: ['T_sky: Swinbank correlation', 'Panel-to-sky view factor', 'Grey-body Stefan-Boltzmann (epsilon=0.9 for Si surface)', 'Long-wave radiation exchange'], deps: ['precision_module', 'constants_module'], description: 'Long-wave radiation exchange between panel surface and sky.' },
                { name: 'air_layer_module', file: 'air_layer_module.f90', lines: 169, complete: 100, functions: ['Thermal resistance from trapped air gap (1‚Äì5mm)', 'Natural convection correlation (Nu vs Ra)', 'Panel-to-mounting surface heat path'], deps: ['precision_module', 'constants_module'], description: 'Thin air layer between panel and mounting surface: thermal resistance and natural convection.' }
            ],
            ml: [
                { name: 'state_feature_module', file: 'state_feature_module.f90', lines: 727, complete: 100, functions: ['compute_state_features()', 'Temperature gradient feature', 'Rate of change feature', 'Remaining compute budget feature', 'Sobol sensitivity index estimates', 'Iteration count'], deps: ['types_module', 'precision_module'], description: 'Computes RL state features from current simulation state. Feeds ml_orchestrator.' },
                { name: 'reward_function_module', file: 'reward_function_module.f90', lines: 614, complete: 100, functions: ['compute_reward()', 'r = improvement(Pmp) - cost(action) + r_phys', 'r_phys = -alpha*max(0, delta_Pmp_hf - delta_Pmp_lf)/sigma_lf', 'Ng et al. 1999 reward shaping'], deps: ['precision_module', 'constants_module'], description: 'RL reward computation with physics-consistency penalty for HF/LF discrepancy.' },
                { name: 'decision_tree_module', file: 'decision_tree_module.f90', lines: 466, complete: 100, functions: ['dt_predict(state)', 'Rule: sigma_frac < 2% => STOP', 'Rule: R2 < 0.85 => REFINE', 'Rule: n_HF < 10 => EVAL_HF', 'Fallback policy when Q-table untrained'], deps: ['precision_module'], description: 'Binary decision tree fallback RL policy. Encodes rule-based heuristics when Q-table is untrained.' },
                { name: 'rl_interface_module', file: 'rl_interface_module.f90', lines: 308, complete: 65, functions: ['State discretisation', 'Action dispatch: EVAL_LF/EVAL_HF/REFINE/STOP', 'Reward calculation', 'Q-table file I/O (q_table.dat)'], deps: ['state_feature_module', 'reward_function_module', 'decision_tree_module'], description: '65% ‚Äî SEPARATE Fortran Q-learning implementation from simv4_wrapper.py. Gap 6: two independent Q-tables never communicate. Requires design decision to unify.' },
                { name: 'ml_orchestrator_module', file: 'ml_orchestrator_module.f90', lines: 326, complete: 100, functions: ['orchestrate_rl_step()', 'Calls state_feature -> reward_function -> rl_interface in sequence', 'Manages Fortran-side RL episode loop'], deps: ['state_feature_module', 'reward_function_module', 'rl_interface_module'], description: 'Coordinates the Fortran-side RL training loop inside sim4_command_module.' }
            ],
            optimization: [
                { name: 'timestep_adjustment', file: 'timestep_adjustment.f90', lines: 237, complete: 100, functions: ['adjust_dt()', 'Stability-preserving dt control', 'Minimises total simulation wall time'], deps: ['precision_module'], description: 'Adaptive timestep control coordinated with solver stability constraints.' },
                { name: 'adjoint_module', file: 'adjoint_module.f90', lines: 794, complete: 100, functions: ['compute_sensitivity_gradient()', 'Backward integration: -rho*cp*d_lambda/dt + k*nabla^2(lambda) - u.nabla(lambda) = dJ/dT', 'dJ/d[k_thermal, alpha, h_convect] analytically'], deps: ['types_module', 'precision_module'], description: 'Lagrange multiplier adjoint sensitivity. Analytically computes gradients ‚Äî much faster than finite differences.' },
                { name: 'adjoint_gradient_check_module', file: 'adjoint_gradient_check_module.f90', lines: 571, complete: 85, functions: ['run_gradient_check()', 'Albany Taylor remainder test', 'Verifies O(eps^2) convergence rate', 'gc_result%adjoint_verified flag'], deps: ['adjoint_module', 'precision_module'], description: '85% ‚Äî Module is complete. Gap 4: call site in sim1_command_module.f90 is bypassed ("requires forward_eval function pointer"). Needs ~3hr fix.' },
                { name: 'mcmc_sampler_module', file: 'mcmc_sampler_module.f90', lines: 963, complete: 100, functions: ['Adaptive Metropolis-Hastings MCMC', 'R-hat convergence diagnostic', 'ESS (effective sample size)', 'Bayesian posterior sampling over design parameters'], deps: ['precision_module', 'constants_module'], description: 'Adaptive M-H MCMC for Bayesian posterior sampling. Feeds uncertainty quantification in SimV3.' },
                { name: 'pso_module', file: 'pso_module.f90', lines: 953, complete: 100, functions: ['pso_optimize()', 'Clerc constriction: w=0.729, c1=c2=1.49445 (theoretically stable)', 'Swarm fitness via simv2_pso_fitness_module', 'CP-ALS tensor surrogate approximation'], deps: ['precision_module', 'constants_module', 'tensor_surrogate_module', 'simv2_pso_fitness_module'], description: 'PSO with Clerc constriction factor. Uses tensor surrogate to approximate fitness landscape.' },
                { name: 'simv2_pso_fitness_module', file: 'simv2_pso_fitness_module.f90', lines: 568, complete: 100, functions: ['fitness_fn(theta)', 'J = w_T*RMSE(T,T_target) + w_cost*t_cpu + w_unif*uniformity_penalty', 'Short LF+HF simulation per design point'], deps: ['lofi_solver_module', 'hifi_solver_module', 'types_module'], description: 'PSO fitness function for SimV2. Evaluates combined LF+HF cost at each design point theta.' },
                { name: 'bayesian_module', file: 'bayesian_module.f90', lines: 931, complete: 100, functions: ['Kennedy-O\'Hagan co-Kriging: f_HF(x)=rho*f_LF(x)+delta(x)', 'Cholesky K^-1 solve', 'GP hyperparameter marginal likelihood optimisation', 'GP_MAX_TRAIN=200 point cap', 'Mean and variance estimates'], deps: ['precision_module', 'constants_module'], description: 'Kennedy-O\'Hagan multi-fidelity co-Kriging GP. Combines cheap LF and expensive HF evaluations.' },
                { name: 'acquisition_module', file: 'acquisition_module.f90', lines: 148, complete: 100, functions: ['EI: Expected Improvement (Mockus 1974)', 'UCB: Upper Confidence Bound (kappa=2)', 'PI: Probability of Improvement', 'PIAF: UCB - lambda*C_phys (penalises T_cell > 85¬∞C)'], deps: ['bayesian_module', 'precision_module'], description: 'Acquisition functions for Bayesian optimisation: EI, UCB, PI, and physics-informed PIAF.' },
                { name: 'optimization_module', file: 'optimization_module.f90', lines: 328, complete: 100, functions: ['Selects algorithm: PSO / BO / MCMC', 'Manages compute budget', 'Tracks best design found', 'Writes optimisation history CSV'], deps: ['pso_module', 'bayesian_module', 'mcmc_sampler_module', 'adjoint_module'], description: 'Top-level optimisation coordinator. Dispatches to PSO, BO, or MCMC based on config.' }
            ],
            command: [
                { name: 'main', file: 'main.f90', lines: 1273, complete: 100, functions: ['PROGRAM aura_mf entry point', 'Parses all CLI flags: --mode, --grid, --dt, --time, --optical-props, --fidelity, --lat/lon/alt, --location, --pso-particles/iterations, --spectral-mismatch (pending Gap 3)', '--test: runs 8 self-tests'], deps: ['tuning_module', 'types_module', 'error_module', 'all sim command modules'], description: 'Main Fortran entry point. All CLI flags implemented including --fidelity override (Gap 2 resolved).' },
                { name: 'sim1_command_module', file: 'sim1_command_module.f90', lines: 737, complete: 90, functions: ['execute_simv1()', 'Full BTE MC + CN heat + NS buoyancy', 'Adjoint sensitivity computation', 'Writes simv1_timeseries.csv'], deps: ['hifi_solver_module', 'adjoint_module', 'adjoint_gradient_check_module', 'timer_module'], description: '90% ‚Äî SimV1 high-fidelity runner. Gap 4: adjoint gradient check call site bypassed (run_gradient_check commented out, ~3hr fix).' },
                { name: 'sim2_command_module', file: 'sim2_command_module.f90', lines: 938, complete: 95, functions: ['execute_simv2()', 'PSO with Clerc constriction', 'LF+MF+HF alternating fidelity', 'T_corrected blending', 'Writes pso_convergence.csv'], deps: ['lofi_solver_module', 'mefi_solver_module', 'hifi_solver_module', 'pso_module', 'fidelity_manager_module'], description: 'SimV2 multi-fidelity + PSO. Alternates LF Beer-Lambert and HiFi BTE MC solvers.' },
                { name: 'sim3_command_module', file: 'sim3_command_module.f90', lines: 1389, complete: 90, functions: ['execute_simv3()', 'co-Kriging GP surrogate (Kennedy-O\'Hagan)', 'EI/UCB/PI/PIAF acquisition', 'LF initial sampling then HF refinement', 'Writes simv3_gp_diagnostics.csv'], deps: ['lofi_solver_module', 'hifi_solver_module', 'bayesian_module', 'acquisition_module', 'fidelity_manager_module'], description: '90% ‚Äî SimV3 Bayesian optimisation. --fidelity flag resolved (Gap 2 fixed). GP_MAX_TRAIN capped at 200 points.' },
                { name: 'sim4_command_module', file: 'sim4_command_module.f90', lines: 1137, complete: 60, functions: ['execute_simv4()', 'Fortran-side Q-learning over HiFi (~50s/eval)', 'ml_orchestrator RL episode loop', 'Action space: EVAL_LF/EVAL_HF/REFINE/STOP', 'Writes rl_actions.csv'], deps: ['lofi_solver_module', 'hifi_solver_module', 'ml_orchestrator_module', 'rl_interface_module'], description: '60% ‚Äî SimV4 RL-orchestrated. Gap 6: entirely separate Q-table from Python simv4_wrapper.py (different state space, ~50s vs 0.1ms evals). Requires architecture unification decision.' }
            ],
            utility: [
                { name: 'io_module', file: 'io_module.f90', lines: 581, complete: 100, functions: ['read_input_file()', 'write_live_data(): appends CSV row with FLUSH for real-time Rust GUI polling', 'write_vtk_files(): VTK visualisation export'], deps: ['types_module', 'precision_module', 'error_module'], description: 'File I/O. FLUSH on every live_data.csv write ensures Rust GUI graphs.rs receives real-time updates.' },
                { name: 'sim_utils_module', file: 'sim_utils_module.f90', lines: 1070, complete: 100, functions: ['Timestep validation', 'Grid interpolation', 'Boundary flux computation', 'Progress reporting', 'Convergence checks'], deps: ['types_module', 'precision_module'], description: 'Shared simulation utilities used by all four sim command modules.' },
                { name: 'timer_module', file: 'timer_module.f90', lines: 95, complete: 100, functions: ['tic()', 'toc()', 'Wall-clock and CPU-time profiling'], deps: ['precision_module'], description: 'Lightweight profiling. Feeds performance counters in data_module.' },
                { name: 'validation_module', file: 'validation_module.f90', lines: 75, complete: 100, functions: ['Post-run physics validation', 'T < 500 K check', 'NaN/Inf field check', 'RMSE(T, T_target) < threshold', 'Sets results%validation_passed'], deps: ['precision_module', 'types_module'], description: 'Post-run sanity checks on all output fields.' },
                { name: 'fidelity_manager_module', file: 'fidelity_manager_module.f90', lines: 744, complete: 95, functions: ['derive_mf_hf_from_lf()', 'LF 1-20 => 1/5 ratio', 'LF 21-50 => 1/8 ratio', 'LF >250 => 1/30 ratio', 'Must stay in sync with simv3_wrapper.get_scaling_factor()'], deps: ['precision_module', 'types_module'], description: '95% ‚Äî LF/MF/HF solver switching with fidelity ratio table. Must stay in sync with Python simv3_wrapper.py.' },
                { name: 'tensor_surrogate_module', file: 'tensor_surrogate_module.f90', lines: 828, complete: 100, functions: ['CP-ALS (Canonical Polyadic Alternating Least Squares)', 'Tensor surrogate for PSO fitness landscape', 'Reduces expensive evaluations by interpolation'], deps: ['precision_module', 'constants_module'], description: 'CP-ALS tensor surrogate. Approximates fitness landscape for PSO to reduce expensive HiFi calls.' },
                { name: 'cleanup_utilities', file: 'cleanup_utilities.f90', lines: 241, complete: 100, functions: ['Memory deallocation', 'File handle cleanup', 'Graceful shutdown on error'], deps: ['types_module', 'error_module'], description: 'Deallocation and graceful shutdown. Called in main.f90 FINALIZE and from error handlers.' }
            ],
            python: [
                { name: 'run_sim.py', file: 'run_sim.py', lines: 209, complete: 100, functions: ['main entry point', 'Routes --mode to SimV1/2/3/4Runner', 'Reads run_config.json fallback', 'Location presets: sanjose/london/tokyo/sydney/phoenix'], deps: ['simv1_wrapper', 'simv2_wrapper', 'simv3_wrapper', 'simv4_wrapper'], description: 'Python orchestration entry point. Routes simulation modes and manages location presets.' },
                { name: 'simv1_wrapper.py', file: 'simv1_wrapper.py', lines: 520, complete: 90, functions: ['SimV1Runner', 'Stage 1: Perez POA irradiance, Fresnel IAM, Faiman thermal', 'Stage 2: subprocess to bin/aura_mf --mode simv1', 'Writes fortran_bc.csv (M_spectral in col 3)'], deps: ['pv_physics_engine', 'sim1_command_module'], description: '90% ‚Äî Gap 3: writes M_spectral to fortran_bc.csv col 3 but Fortran never reads it. ~5% photon energy error. ~3hr fix.' },
                { name: 'simv2_wrapper.py', file: 'simv2_wrapper.py', lines: 722, complete: 95, functions: ['SimV2Runner', 'LHS initial sampling', 'PSO swarm management', 'Surrogate model interface', 'Results aggregation'], deps: ['pv_physics_engine', 'sim2_command_module'], description: 'Python interface to SimV2 PSO. Manages Latin Hypercube Sampling and surrogate construction.' },
                { name: 'simv3_wrapper.py', file: 'simv3_wrapper.py', lines: 879, complete: 95, functions: ['SimV3Runner', '_evaluate_at_fidelity(theta, fidelity)', 'get_scaling_factor(): fidelity ratio table (must sync with fidelity_manager_module.f90)', 'GP posterior analysis', 'Writes simv3_summary.csv'], deps: ['pv_physics_engine', 'bayesian_analysis', 'sim3_command_module'], description: 'Python interface to SimV3 Bayesian BO. get_scaling_factor() must stay in sync with Fortran fidelity_manager_module.' },
                { name: 'simv4_wrapper.py', file: 'simv4_wrapper.py', lines: 671, complete: 65, functions: ['SimV4Runner', 'Python Q-table over SAPM surrogate (~0.1ms/eval)', 'epsilon-greedy: 1.0->0.1 over 500 episodes', '128-state space', 'Saves simv4_qtable.npy'], deps: ['pv_physics_engine', 'sim4_command_module'], description: '65% ‚Äî Gap 6: Python Q-table (SAPM surrogate, 128 states, 0.1ms/eval) completely separate from Fortran Q-table (HiFi, ~50s/eval). Must be unified.' },
                { name: 'pv_physics_engine.py', file: 'pv_physics_engine.py', lines: 1966, complete: 100, functions: ['Perez transposition model (POA irradiance)', 'Fresnel IAM reflection losses', 'Faiman thermal model (T_cell)', 'SAPM cell parameters', 'Spectral mismatch factor M_spectral'], deps: [], description: 'Core Python physics module. All four sim wrappers call this for preprocessing. Most physics-critical Python file.' },
                { name: 'weather_bridge.py', file: 'weather_bridge.py', lines: 533, complete: 100, functions: ['AR(1)+Fourier weather generation (Python-side)', 'Validates against Fortran climate_zone_module coefficients', 'test_weather_bridge.py integration'], deps: ['pv_physics_engine'], description: 'Python-side weather generation bridge. AR(1)+Fourier model matching Fortran weather_driver_module.' },
                { name: 'bayesian_analysis.py', file: 'bayesian_analysis.py', lines: 1201, complete: 100, functions: ['GP posterior visualisation', 'Sobol sensitivity analysis', 'MCMC trace diagnostics', 'R-hat and ESS reporting', 'Reads simv3_gp_diagnostics.csv and simv4/rl_actions.csv'], deps: ['simv3_wrapper', 'simv4_wrapper'], description: 'Post-processing and visualisation for Bayesian and RL results.' },
                { name: 'build_manager.py', file: 'build_manager.py', lines: 692, complete: 90, functions: ['build target: make + cmake', 'prepare-data target: calls DataAcquisitionManager', 'python-install target: pip install -e python/', '--test target: bin/aura_mf --test'], deps: ['data_acquisition'], description: '90% ‚Äî Gap 1: --test step does not yet invoke pytest python/tests/. Test suite exists but not wired. ~4hr fix.' },
                { name: 'data_acquisition.py', file: 'data_acquisition.py', lines: 579, complete: 95, functions: ['DataAcquisitionManager.run_all()', 'process_silicon_optical(): generates si_nk_table.dat', 'fetch_astm_g173(): AM1.5G spectrum', 'fetch_standard_atmosphere(): JSON LUT', 'Called by build_manager.py prepare-data target (Gap 5 resolved)'], deps: [], description: '95% ‚Äî Gap 5 resolved. Generates all data/ files. Still requires data/si_nk_table.dat source (manual download from refractiveindex.info).' }
            ]
        };

        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });

        // Render modules
        function renderModules(filter = 'all', search = '') {
            const container = document.getElementById('module-list');
            container.innerHTML = '';
            
            Object.entries(modules).forEach(([category, mods]) => {
                if (filter !== 'all' && filter !== category) return;
                
                mods.forEach(mod => {
                    const searchStr = `${mod.name} ${mod.description} ${mod.functions.join(' ')}`.toLowerCase();
                    if (search && !searchStr.includes(search.toLowerCase())) return;
                    
                    const card = document.createElement('div');
                    card.className = `module-card ${category}`;
                    
                    let badge = mod.complete >= 85 ? 'complete' : mod.complete >= 60 ? 'progress' : 'experimental';
                    let badgeText = mod.complete >= 85 ? 'Complete' : mod.complete >= 60 ? 'In Progress' : 'Experimental';
                    
                    card.innerHTML = `
                        <div class="module-title">${mod.name}</div>
                        <div class="module-info">${mod.file}</div>
                        <div class="module-info">${mod.lines} lines</div>
                        <div class="module-info">${mod.description}</div>
                        <span class="badge ${badge}">${badgeText} (${mod.complete}%)</span>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${mod.complete}%;"></div>
                        </div>
                    `;
                    
                    card.addEventListener('click', () => showModuleDetails(mod, category));
                    container.appendChild(card);
                });
            });
        }

        // Show module details
        function showModuleDetails(mod, category) {
            const modal = document.getElementById('module-modal');
            const modalBody = document.getElementById('modal-body');
            
            let badge = mod.complete >= 85 ? 'complete' : mod.complete >= 60 ? 'progress' : 'experimental';
            let badgeText = mod.complete >= 85 ? 'Complete' : mod.complete >= 60 ? 'In Progress' : 'Experimental';
            
            modalBody.innerHTML = `
                <h2 style="color: #667eea; margin-bottom: 20px;">${mod.name}</h2>
                <div style="margin-bottom: 20px;">
                    <span class="badge ${badge}">${badgeText}</span>
                    <span class="badge" style="background: #e0e0e0; color: #333;">${category}</span>
                </div>
                
                <div class="progress-bar" style="margin-bottom: 30px;">
                    <div class="progress-fill" style="width: ${mod.complete}%;"></div>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <strong>File:</strong> <code>${mod.file}</code><br>
                    <strong>Lines of Code:</strong> ${mod.lines}<br>
                    <strong>Completion:</strong> ${mod.complete}%
                </div>
                
                <div style="margin-bottom: 20px;">
                    <strong style="font-size: 1.1em;">Description</strong>
                    <p style="margin-top: 10px; color: #666;">${mod.description}</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <strong style="font-size: 1.1em;">Key Functions/Features</strong>
                    <ul style="margin-top: 10px; padding-left: 20px;">
                        ${mod.functions.map(f => `<li>${f}</li>`).join('')}
                    </ul>
                </div>
                
                ${mod.deps.length > 0 ? `
                <div>
                    <strong style="font-size: 1.1em;">Dependencies</strong>
                    <ul class="dependency-list" style="margin-top: 10px;">
                        ${mod.deps.map(d => `<li>${d}</li>`).join('')}
                    </ul>
                </div>
                ` : '<p style="color: #666;"><em>No dependencies (foundation module)</em></p>'}
            `;
            
            modal.classList.add('active');
        }

        // Close modal
        document.querySelector('.close-modal').addEventListener('click', () => {
            document.getElementById('module-modal').classList.remove('active');
        });

        document.getElementById('module-modal').addEventListener('click', (e) => {
            if (e.target.id === 'module-modal') {
                e.target.classList.remove('active');
            }
        });

        // Filter buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                renderModules(btn.dataset.filter, document.getElementById('module-search').value);
            });
        });

        // Search
        document.getElementById('module-search').addEventListener('input', (e) => {
            const activeFilter = document.querySelector('.filter-btn.active').dataset.filter;
            renderModules(activeFilter, e.target.value);
        });

        // Initial render
        renderModules();
    </script>
</body>