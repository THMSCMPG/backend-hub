<!-- 
  BTE-NS Simulator Responsive Wrapper
  Automatically loads desktop or mobile version based on screen size
  Place this in your layout file or main page
-->

<div id="bte-ns-simulator-wrapper">
    <!-- Desktop version (loaded by default, hidden on mobile) -->
    <div id="bte-ns-desktop" class="bte-ns-responsive-container">
        {% include bte_ns_simulator.html %}
    </div>
    
    <!-- Mobile version (hidden by default, shown on mobile) -->
    <div id="bte-ns-mobile" class="bte-ns-responsive-container" style="display: none;">
        {% include bte_ns_simulator_mobile.html %}
    </div>
</div>


<script>
/**
 * BTE-NS Responsive Switcher
 * Handles dynamic switching between desktop and mobile versions
 * Reloads appropriate version when screen is resized across breakpoint
 */
(function() {
    'use strict';
    
    const MOBILE_BREAKPOINT = 768; // pixels
    let currentMode = null;
    
    function detectMode() {
        return window.innerWidth <= MOBILE_BREAKPOINT ? 'mobile' : 'desktop';
    }
    
    function switchMode(newMode) {
        if (newMode === currentMode) return; // No change needed
        
        console.log(`ðŸ“± Switching BTE-NS simulator to ${newMode} mode`);
        
        const desktopDiv = document.getElementById('bte-ns-desktop');
        const mobileDiv = document.getElementById('bte-ns-mobile');
        
        if (newMode === 'mobile') {
            if (desktopDiv) desktopDiv.style.display = 'none';
            if (mobileDiv) mobileDiv.style.display = 'block';
        } else {
            if (desktopDiv) desktopDiv.style.display = 'block';
            if (mobileDiv) mobileDiv.style.display = 'none';
        }
        
        currentMode = newMode;
        
        // Dispatch event so simulator can reinitialize if needed
        window.dispatchEvent(new CustomEvent('bte-ns-mode-changed', { 
            detail: { mode: newMode } 
        }));
    }
    
    // Initial setup
    function init() {
        const initialMode = detectMode();
        switchMode(initialMode);
        console.log(`âœ… BTE-NS responsive wrapper initialized in ${initialMode} mode`);
    }
    
    // Handle window resize with debouncing
    let resizeTimeout;
    window.addEventListener('resize', () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
            const newMode = detectMode();
            switchMode(newMode);
        }, 250); // Debounce 250ms
    });
    
    // Handle orientation change on mobile devices
    window.addEventListener('orientationchange', () => {
        setTimeout(() => {
            const newMode = detectMode();
            switchMode(newMode);
        }, 300); // Delay to let orientation change complete
    });
    
    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }
    
    // Expose mode detector globally for debugging
    window.BTENSResponsive = {
        getCurrentMode: () => currentMode,
        forceMode: (mode) => switchMode(mode),
        getBreakpoint: () => MOBILE_BREAKPOINT
    };
    
})();
</script>