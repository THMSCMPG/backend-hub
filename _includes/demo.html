
<section class="demo-section">
    <div class="container">
        <div class="header">
            <h1>âš¡ AURA-MF Interactive Demo</h1>
            <p>Adaptive Unified Radiative Analysis - Multi-Fidelity Framework</p>
            <p style="font-size: 0.9em; margin-top: 10px; opacity: 0.8;">
                Low-Fidelity 25Ã—25 Resolution Demo
            </p>
        </div>
        
        <div class="content">
            <div class="controls">
                <h2 style="color: #2c3e50; margin-bottom: 25px;">Simulation Parameters</h2>
                
                <div class="parameter-group">
                    <label>
                        Solar Irradiance
                        <span class="parameter-value" id="solar-value">1000</span> W/mÂ²
                    </label>
                    <input type="range" id="solar-irradiance" min="800" max="1200" value="1000" step="10">
                    <div class="param-info">Incident solar radiation on panel surface</div>
                </div>
                
                <div class="parameter-group">
                    <label>
                        Ambient Temperature
                        <span class="parameter-value" id="temp-value">27</span> Â°C
                    </label>
                    <input type="range" id="ambient-temperature" min="280" max="330" value="300" step="1">
                    <div class="param-info">Surrounding air temperature</div>
                </div>
                
                <div class="parameter-group">
                    <label>
                        Wind Speed
                        <span class="parameter-value" id="wind-value">1.0</span> m/s
                    </label>
                    <input type="range" id="wind-speed" min="0" max="10" value="1" step="0.1">
                    <div class="param-info">Affects convective cooling rate</div>
                </div>
                
                <div class="parameter-group">
                    <label>
                        Cell Efficiency
                        <span class="parameter-value" id="efficiency-value">20</span> %
                    </label>
                    <input type="range" id="cell-efficiency" min="0.10" max="0.30" value="0.20" step="0.01">
                    <div class="param-info">Base electrical conversion efficiency</div>
                </div>
                
                <div class="parameter-group">
                    <label>
                        Thermal Conductivity
                        <span class="parameter-value" id="conductivity-value">130</span> W/(mÂ·K)
                    </label>
                    <input type="range" id="thermal-conductivity" min="100" max="200" value="130" step="5">
                    <div class="param-info">In-plane heat conduction</div>
                </div>
                
                <div class="parameter-group">
                    <label>
                        Absorptivity
                        <span class="parameter-value" id="absorptivity-value">0.95</span>
                    </label>
                    <input type="range" id="absorptivity" min="0.85" max="0.98" value="0.95" step="0.01">
                    <div class="param-info">Fraction of incident solar radiation absorbed</div>
                </div>
                
                <div class="parameter-group">
                    <label>
                        Emissivity
                        <span class="parameter-value" id="emissivity-value">0.90</span>
                    </label>
                    <input type="range" id="emissivity" min="0.80" max="0.95" value="0.90" step="0.01">
                    <div class="param-info">Radiative heat loss efficiency</div>
                </div>
                
                <button class="run-button" id="run-button" onclick="runSimulation()">
                    ðŸš€ Run Simulation
                </button>
                
                <button class="reset-button" onclick="resetParameters()">
                    â†º Reset to Defaults
                </button>
            </div>
            
            <div class="visualization">
                <div class="error" id="error-message"></div>
                
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Running simulation...</p>
                </div>
                
                <div id="results-container" style="display: none; width: 100%;">
                    <img id="visualization-image" src="" alt="Simulation Results">
                    
                    <div class="results">
                        <h3>ðŸ“Š Simulation Results</h3>
                        <div class="result-grid">
                            <div class="result-item">
                                <label>Mean Temperature</label>
                                <div class="value" id="temp-mean">-</div>
                            </div>
                            <div class="result-item">
                                <label>Max Temperature</label>
                                <div class="value" id="temp-max">-</div>
                            </div>
                            <div class="result-item">
                                <label>Total Power Output</label>
                                <div class="value" id="power-total">-</div>
                            </div>
                            <div class="result-item">
                                <label>Average Efficiency</label>
                                <div class="value" id="efficiency-avg">-</div>
                            </div>
                        </div>
                        <div style="margin-top: 15px; text-align: center; color: #6c757d; font-size: 0.9em;">
                            Computation time: <span id="runtime">-</span> ms
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<iframe 
    id="backend-bridge" 
    src="https://thmscmpg.github.io/backend-hub/" 
    style="display:none; width:0; height:0; border:0;"
    title="backend-hub">
</iframe>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .content {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 0;
        }
        
        .controls {
            background: #f8f9fa;
            padding: 30px;
            border-right: 1px solid #dee2e6;
            overflow-y: auto;
            max-height: calc(100vh - 200px);
        }
        
        .visualization {
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .parameter-group {
            margin-bottom: 25px;
        }
        
        .parameter-group label {
            display: block;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        
        .parameter-value {
            color: #667eea;
            font-weight: 700;
            float: right;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #d3d3d3;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .param-info {
            font-size: 0.85em;
            color: #6c757d;
            margin-top: 4px;
        }
        
        .run-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 20px;
        }
        
        .run-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }
        
        .run-button:active {
            transform: translateY(0);
        }
        
        .run-button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }
        
        .reset-button {
            width: 100%;
            padding: 12px;
            background: #95a5a6;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .reset-button:hover {
            background: #7f8c8d;
        }
        
        #visualization-image {
            max-width: 100%;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .results {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            width: 100%;
            max-width: 800px;
        }
        
        .results h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .result-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .result-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .result-item label {
            display: block;
            font-size: 0.9em;
            color: #6c757d;
            margin-bottom: 5px;
        }
        
        .result-item .value {
            font-size: 1.4em;
            font-weight: 700;
            color: #2c3e50;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .loading.active {
            display: block;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            background: #fee;
            color: #c00;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }
        
        .error.active {
            display: block;
        }
        
        @media (max-width: 1024px) {
            .content {
                grid-template-columns: 1fr;
            }
            
            .controls {
                border-right: none;
                border-bottom: 1px solid #dee2e6;
                max-height: none;
            }
        }
    </style>
</section>


    <script>
        // Update slider value displays
        const sliders = [
            {id: 'solar-irradiance', display: 'solar-value', format: v => v},
            {id: 'ambient-temperature', display: 'temp-value', format: v => (v - 273.15).toFixed(1)},
            {id: 'wind-speed', display: 'wind-value', format: v => parseFloat(v).toFixed(1)},
            {id: 'cell-efficiency', display: 'efficiency-value', format: v => (v * 100).toFixed(0)},
            {id: 'thermal-conductivity', display: 'conductivity-value', format: v => v},
            {id: 'absorptivity', display: 'absorptivity-value', format: v => parseFloat(v).toFixed(2)},
            {id: 'emissivity', display: 'emissivity-value', format: v => parseFloat(v).toFixed(2)}
        ];
        
        sliders.forEach(slider => {
            const element = document.getElementById(slider.id);
            const display = document.getElementById(slider.display);
            
            element.addEventListener('input', function() {
                display.textContent = slider.format(this.value);
            });
        });
        
        async function runSimulation() {
            // Collect parameters
            const params = {
                solar_irradiance: parseFloat(document.getElementById('solar-irradiance').value),
                ambient_temperature: parseFloat(document.getElementById('ambient-temperature').value),
                wind_speed: parseFloat(document.getElementById('wind-speed').value),
                cell_efficiency: parseFloat(document.getElementById('cell-efficiency').value),
                thermal_conductivity: parseFloat(document.getElementById('thermal-conductivity').value),
                absorptivity: parseFloat(document.getElementById('absorptivity').value),
                emissivity: parseFloat(document.getElementById('emissivity').value)
            };
            
            // Show loading, hide results and errors
            document.getElementById('loading').classList.add('active');
            document.getElementById('results-container').style.display = 'none';
            document.getElementById('error-message').classList.remove('active');
            document.getElementById('run-button').disabled = true;
            
            try {
                const response = await fetch('/api/simulate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(params)
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Simulation failed');
                }
                
                // Display results
                displayResults(data);
                
            } catch (error) {
                document.getElementById('error-message').textContent = 
                    'âŒ Error: ' + error.message;
                document.getElementById('error-message').classList.add('active');
            } finally {
                document.getElementById('loading').classList.remove('active');
                document.getElementById('run-button').disabled = false;
            }
        }
        
        function displayResults(data) {
            const results = data.results;
            
            // Show visualization
            document.getElementById('visualization-image').src = 
                'data:image/png;base64,' + data.visualization;
            
            // Update result values
            document.getElementById('temp-mean').textContent = 
                (results.temperature_mean - 273.15).toFixed(1) + ' Â°C';
            document.getElementById('temp-max').textContent = 
                (results.temperature_max - 273.15).toFixed(1) + ' Â°C';
            document.getElementById('power-total').textContent = 
                results.power_total.toFixed(2) + ' W';
            document.getElementById('efficiency-avg').textContent = 
                (results.efficiency_avg * 100).toFixed(1) + ' %';
            document.getElementById('runtime').textContent = 
                results.runtime_ms.toFixed(1);
            
            // Show results
            document.getElementById('results-container').style.display = 'block';
        }
        
        function resetParameters() {
            document.getElementById('solar-irradiance').value = 1000;
            document.getElementById('ambient-temperature').value = 300;
            document.getElementById('wind-speed').value = 1;
            document.getElementById('cell-efficiency').value = 0.20;
            document.getElementById('thermal-conductivity').value = 130;
            document.getElementById('absorptivity').value = 0.95;
            document.getElementById('emissivity').value = 0.90;
            
            // Trigger input events to update displays
            sliders.forEach(slider => {
                const element = document.getElementById(slider.id);
                element.dispatchEvent(new Event('input'));
            });
        }
        
        // Initialize displays
        window.addEventListener('load', () => {
            sliders.forEach(slider => {
                const element = document.getElementById(slider.id);
                element.dispatchEvent(new Event('input'));
            });
        });
    </script>
